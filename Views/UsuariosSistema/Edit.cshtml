@model VN_Center.Models.Entities.UsuariosSistema

@{
    ViewData["Title"] = "Editar Usuario del Sistema";
    var opcionesActivo = new List<SelectListItem>
    {
        new SelectListItem { Value = "true", Text = "Sí" },
        new SelectListItem { Value = "false", Text = "No" }
    };
}

<div class="container-xxl flex-grow-1 container-p-y">

    <h4 class="fw-bold py-3 mb-4">
        <span class="text-muted fw-light">Administración / Usuarios del Sistema /</span> Editar Usuario
    </h4>

    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Editando Usuario: @Model.NombreUsuario</h5>
                </div>
                <div class="card-body">
                    <form asp-action="Edit" method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                        <input type="hidden" asp-for="UsuarioID" />
                        @* Preservar el hash de la contraseña original si no se va a cambiar explícitamente en este formulario.
                           El controlador tiene lógica para manejar esto. Si el campo HashContrasena se deja vacío,
                           el controlador reasigna el hash existente. Si se ingresa uno nuevo, se usa ese.
                           Alternativamente, se podría tener un campo separado "Nueva Contraseña" y lógica más explícita.
                        *@
                        <input type="hidden" asp-for="HashContrasena" />
                        <input type="hidden" asp-for="FechaUltimoAcceso" />


                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Nombres" class="form-label"></label>
                                <input asp-for="Nombres" class="form-control" />
                                <span asp-validation-for="Nombres" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Apellidos" class="form-label"></label>
                                <input asp-for="Apellidos" class="form-control" />
                                <span asp-validation-for="Apellidos" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="NombreUsuario" class="form-label"></label>
                            <input asp-for="NombreUsuario" class="form-control" readonly /> @* El nombre de usuario usualmente no se edita *@
                            <span asp-validation-for="NombreUsuario" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" type="email" class="form-control" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>

                        <div class="mb-3 form-password-toggle">
                            <label class="form-label" for="newPassword">Nueva Contraseña (opcional)</label>
                            <div class="input-group input-group-merge">
                                <input type="password" id="newPassword" name="NewPassword" class="form-control" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="new-password" />
                                <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                            </div>
                            <small class="form-text text-muted">Dejar en blanco si no desea cambiar la contraseña actual.</small>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="RolUsuarioID" class="form-label"></label>
                                <select asp-for="RolUsuarioID" class="form-select" asp-items="ViewBag.RolUsuarioID">
                                    <option value="">Seleccione un rol...</option>
                                </select>
                                <span asp-validation-for="RolUsuarioID" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Activo" class="form-label"></label>
                                <select asp-for="Activo" class="form-select" asp-items="opcionesActivo"></select>
                                <span asp-validation-for="Activo" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary me-2">Guardar Cambios</button>
                            <a asp-action="Index" class="btn btn-outline-secondary">Cancelar</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
